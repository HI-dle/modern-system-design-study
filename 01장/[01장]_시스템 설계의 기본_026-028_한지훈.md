# 시스템 설계의 기본

---


## 1.2.2 하위 수준의 상세 설계

- 상위 시스템 설께 이후에 하위 시스템 설계는 시스템 구성 요소의 구현 세부 사항에 중점을 둔다.
- 성능, 메모리 사용, 코드 유지 보수성을 최적화 하는 데 적절한 알고리즘, 데이터 구조, API를 성택하는 작업이 들어간다.

- 상세 설계 주요 요소
  - 알고리즘: 계산이나 데이터 처리,  문제 해결 과정을 의미
  - 데이터 구조: 메모리 내에서 데이터를 관리하고 운용하는 방식
  - API: 서로 다른 구성 요소나 서비스 간 통신을 가능하게 하는 인터페이스
  - 코드 최적화: 코드의 성능, 가독성, 유지 보수성을 향상시키는 기법

### 알고리즘

- 하위 수준 시스템 설계에서 계산, 데이터 처리, 문제 해결을 수행하는 단계별 절차를 의미한다.
- 효율적인 알고리즘을 선택하는 것은 시스템의 성능, 자원 사용, 유지 보수성을 최적화하는데 필수이다.
- 알고리즘 선택에 고려해야할 요소
  - 시간 복잡도: 입력 데이터의 크기와 연산 횟수의 상관관계
  - 공간 복잡도: 입력 데이터 크기와 사용하는 메모리양 간의 관계를 의미
  - 트레이트 오프: 시스템의 요구 사항과 제약에 따라 시간 복잡도와 공간 복자도 간 균형을 맞추는 것
- 시스템 설계 관점에서 성능 좋은 기기를 비싸게 사는 것 보다 알고리즘을 알맞게 최적화 하는 것이 더 나은 선택이라 할 수 있다.
- 알고리즘은 적절한 데이터 구조를 활용해 촤적화할 수 있다.

### 데이터 구조

- 데이터 구조는 메모리에서 데이터를 구성하고 관리하는 데 사용하며, 이는 시스템의 성능과 자원 사용 영향을 미치는 요소이다.
- 하위 수준의 설계를 하는 과정에서는 적절한 데이터 구조를 선택하는 것이 중요하다.
  - 데이터 접근 방식: 데이터 접근 빈도와 형태로 읽기와 쓰기, 업데이트 같은 작업을 의미
  - 쿼리 성능 : 검색, 삽입, 삭제 등 작업에 대한 시간 복잡도를 의미
  - 메모리 사용량 : 데이터 구조와 그 내용물을 저장하는 데 필요한 메모리 양을 의미
- 시스템 설계에 많이 사용하는 데이터 구조는 배열, 연결 리스트, 해시 테이블, 트리,그래프 등이 있다.

### API

- Application Programming interface로 시스템 내 여러 구성요소 간 통신에 반드시 필요한 요소이다.
- 각 구성 요소가 상호 작용할 수 있도록 하는 규약을 정의한다.
- API로 모듈화와 관심사의 분리를 만들기도 한다.
- API 설계시 고려할점
  - 일관성 : 컴포넌트 모듈 할 것 없이 모든 구성 요소에서 API 설계가 일관성을 유지하여 누가 보더라도 이해하고 사용하기 쉽게 만들어야 한다.
  - 유연성 : 기존 기능에 영향을 주지 않으면서 향후에 생길 변경이나 기능 확장을 대비할 수 있어야 한다.
  - 보안 : 인증, 권한 부여, 입력 유효성 검사 등을 구현하여 시스템이 허용하지 않은 무단 접근과 데이터 유출에 노출되지 않도록 해야한다.
  - 성능 : API의 지연 시간을 최소화하고 자원을 효율적으로 사용할 수 있도록 최적화 한다.

> 옮긴이 노트
> 
> API 엔드포인트를 설계할때 v1로 시작하는 경우가 있다. 예시로 /api/v1/users 같은 방식이다. 이렇게 엔드포인트에 버전을 부여하는 것은 하위 호환성을 보장하기 위해이다.
> 
> 

 - 1.초기 API를 v1 엔드포인트로 배포한다.
 - 2.새로운 요구 사항에 맞춰 v2 엔드포인트를 추가한다.
   - API 개선이 필요할 때 기존 v1을 그대로 유지하며 v2 엔드포인트 만들어 새로운 데이터 구조나 기능을 추가한다. 데이터 제공 방식은 같으나 구조가 다르다고 가정할 수 있다. 사용자 이름을 name에서 user: {name}으로 수정하거나 하는 식이다.
 - 3.기존 클라이언트는 v1를 계속 사용한다. 클라리언트 측에서는 여전히 v1을 통해 사용자 정보를 가져온다. v2를 만들지 않고 v1의 데이터 구조를 변경해 버리면 클라이언트는 기존 코드에서 오류를 발생시켜 사용자는 정삭적으로 서비스를 이용할 수 없게 될 가능성이 크기 때문이다.
 - 4.기존서비스에서 v1을 v2로 변경하도록 수정한다.
   - 이제 기존 시스템에서 v1을 호출하던 부분을 하나씩 v2로 연결하도록 수정한다.
 - 5.사용자에게 제공하던 모든 클라이언트 서비스가 v2를 사용하면 v1을 제거한다.
   - 모든 클라이언트가 v2로 완전히 이동하면 v1을 제거해 api를 깔끔히 정리할 수 있다.

> 서버 코드는 변경시 적용으로 호출하는 클라이언트에 대한 대응을 유연하게 할 수 있지만 클라이언트의 경우 코드 업데이트가 꼭 필요하기 때문이다. 사용중인 클라이언트 버전의 강제 업데이트가 필요하고 강제하지 않더라도 변경 이전과 이후 클라이언트에 대해 모두 호환되어야 하기 때문에 버전으로 관리되어 호환성을 지켜주는 것이다.


### 코드 최적화

- 코드 최적화는 코드의 성능, 가독성, 유지 보수성을 향상시키는 다양한 기법입니다. 하위 수준 시스템을 설계할 때는 코드 최적화로 시스템이 실제 환경에서 원활하게 작동할 수 있도록 해야한다. 코드 최적화 기법은 다음 항목을 내포한다.
  - 리팩터링: 기존 기능을 그대로 유지하면서 코드 구조를 재구성해 가독성과 유지 보수성을 끌어올리는 기법이다.
  - 루프 언롤링: 반복문을 개별 구문 여러 개로 대체해 반복문을 실행할 때 발생하는 오버헤드를 줄이고 성능을 향상시키는 기법이다.
  - 메모리제이션: 이전 실행 결과를 저장해 동일한 결과를 다시 계산하는 시간 절약법이다.
  - 병렬 처리: 작업을 더 작고 개별적인 하위 작업으로 나눠 동시에 실행함으로써 저체 처리 시간을 줄이는 방법이다.

 - 최적화는 방대하고 심오한 주제이다. 집중적으로 다룬 책과 자료가 있을 정도이다.
 - 하위 수준 시스템 설계는 시스템의 구현, 인터페이스, 최적화에 중점을 둔다.


 
