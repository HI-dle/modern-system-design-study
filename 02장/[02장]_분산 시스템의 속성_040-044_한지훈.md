# 분산 시스템의 속성

---


- 다시 예약 서비스 예시로 돌아와 첫번쨰  사용자가 객실을 예약할 때 예약에 쓰기 작업이 우선 db1에만 기록이 되고 잏루 db2, db3으로 복제 된다고 가정하자
- 복제 과정이 진행되는 동안 두번째 사용자가 해당 객실이 예약 가능한지 확인하기 위해 객실 예약 기능 여부를 확인하는 요청을 보낸다. 이때 API 응답은 쓰기 작업이 db2에 복사 되었는지에 따라 예약 가능 혹은 예약 불가가 될 수 있다.

![그림2_2.png](image/%EA%B7%B8%EB%A6%BC2_2.png)



- 시스템 아키텍트로서 우리는 설계할 때 어떤 일관성을 적용할지 선택해야 한다. 어떻게 할 수 있을지 알아보기 앞서 설명에 사용할 용어부터 정리하자.
  - n : 레플리카의 총 개수
  - r : 데이터를 읽을 때 참조할 레플리카 수
  - w : 데이터를 쓸 때 반영할 레플리카 수

 - 시스템은 전체 레플리카 n개를 활용하지만 실제 읽기나 쓰기 작업에 일관성을 평가할 때는 레플리카 r개 또는 w개만 사용한다. 이런 구성에 따라 선택할 수 있는 방식은 다음과 같다.

![표2_1.png](image/%ED%91%9C2_1.png)


 - 예약 시스템에서 최종 일관성을 사용해도 괜찮을까? 란 질문에 강한 일관성이 필요할 것 같다고 생각할 수 있다.
 - 하지만 가용성이란 요소를 생각하면 그렇지만은 않다. 어떤 경우에는 시스템이 항상 이용 가능한 상태를 유지하기 위해 알관성을 약간 포기하더라도 최종 일관성을 선택하는 것이 유리할 수 있기 때문이다.


> 옮긴이 노트
> 
> 마지막으로 하나 남은 자원에 대해 두개의 접근 A,B가 있을 때 만약 시스템이 강한 일관성으로 되어 있고 w = 3, r = 1이었다. 마지막 자원 정보를 레플리카 3 개에 동시 기록하고 모두 업데이트 되고 나서야 다른 접근에도 해당 자원이 소모가 됐다는 반영이 되는 시스템이다.
> 
> 다음은 최종 일관성으로 w = 1, r = 1 설정이라면 쓰기와 읽기가 빨라지고 처리 속도도 빨라지고 더 많은 작업을 할 수 있게 된다. 이때 마지막 자원에 대해 두개의 접근이 일어나고 하나의 접근은 실행되지 않고 롤백되고 하나의 접근만 처리가 될때 두 접근 자체는 처음엔 허용이었지만 먼저 실행된 하나의 접근만 처리되고 하나의 접근은 처리된 것 처럼 되다 결국 처리되지 않은 상태로 반려된다.

### 2.3 가용성

  - 분산 시스템 설계에서 가용성이란 시스템에 장애나 오류가 발생하더라도 사용자에게 서비스를 지속적으로 제공할 수 있는 능력을 의미한다.
  - 가용성이 높은 시스템은 언제나 요청에 응답할 준비가 되어 있고 시스템 내부에서 발생하는 문제와 상관없이 사용자에게 서비스를 제공할 수 있는 시스템이다.

- 예약 서비스 예시에서 쓰기와 읽기 작업을 레플리카 하나 내지 여러 개에서 처리하도록 하면 시스템 가용성을 높일 수 있다.
- 이렇다면 모든 노드가 정상 동작하지 않더라도 일부 노드만으로 요청을 처리할 수 있다. 따라서 일부 노드가 장애 상태에 있더오 시스템 전체는 쓰기와 읽기 요청을 받아들일 수 있어 높은 가용성을 유지할 수 있다.
- 분산 시스템에서 높은 가용성을 유지하긴 어렵다. 시스템은 여러 구성 요소로 되어 있는데 이 구성 요소들은 서버 장애, 네트워크 문제, 통신 오류 등 다양한 장애에 노출 되기 쉽기 때문이다. 각 어느 하나라도 문제를 일으킬 수 있기 때문에 시스템 전체 가용성을 안정적으로 유지하긴 쉽지 않다.

### 가용성을 보장하는 여러 방식

 - 다중화(중복성)
   - 시스템의 일부 구성 요소에 장애가 발생해도 시스템이 계속 작동할 수 있도록 여러 구성 요소나 자원을 중복해 두는 방식이다.
   - 다중화 방식은 다양한 수준에서 구현할 수 있다. 예시로 하드웨어 중복성은 전원 공급 장치나 네트워크 연결 같은 장치를 여러 개 준비하는 것으로 다른 장비가 대신할 수 있게 한다.
   - 반면 소프트웨어 다중화는 프로세스나 서비스를 여러 개 준비해 두는 방식이다. 이것으로 하나의 소프트웨어가 중단되더라도 다른 소프트웨어가 이어서 제공한다.
 - 복제(레플리케이션)
   - 시스템이 다중화를 갖추려면 데이터를 여러 노드에 복제해야 한다. 데이터를 여러 노드에 복제해 두면 일부 노드에 장애가 발생하더라도 다른 노드가 해당 기능을 이어받아 시스템을 계속 운영할 수 있다.
   - 복제 방식에는 여러가지가 있는데, 첫 번째로 액티브-패시브 복제는 한 노드가 주 노드로 작동하고 나머지 노드는 백업으로 대기하는 방식이다. 반면 액티브-액티브 복제는 여러 노드가 동시에 요청을 처리하도록 구성해 가용성을 높이는 방식이다.
 - 로드 밸런싱
   - 여러 노드에 작업량을 고르게 분배함으로써 특정 노드에 과부하가 걸리지 않도록 하고 자원을 효울적으로 사용할 수 있게 하는 방식이다.
   - 로드 밸런싱의 메커니즘은 들어오는 요청을 현재 사용 가능한 노드로 분배해 자원의 활용을 최적화하고 모든 요청을 일부 노드에서만 처리할 때 발생하는 CPU, 메모리, I/O 병목 현상을 방지한다.
 - 장애 감지 및 복구
   - 분산 시스템에서는 노드나 구성 요소의 장애를 감지하고 해결할 수 있는 메커니즘을 갖추고 있다. 하트비팅, 모니터링, 헬스 체크 등 기법을 통해 장애가 발생한 노드를 파악하고, 복구 메커니즘으로 장애가 발생한 구성 요소를 복원하거나 교체할 수 있도록 한다.
 - 장애 전환 빛 복귀
   - 장애 전환은 문제가 발생한 노드나 장치의 요청을 자동으로 백업 노드나 다른 노드로 돌리는 방식이다. 복귀는 문제가 해결되어 원래 노드나 장치를 다시 사용할 수 있게 되면 그쪽으로 다시 요청을 돌려놓는 방식이다.

- 이런 방식을 잘 선택해서 적용하면 분산 시스템이 높은 가용성을 유지하면서도 장애나 중단의 영향을 줄이고 서비스를 끊김 없이 제공할 수 있다. 하지만 높은 가용성을 확보하려면 복잡성이 증가하거나 자원 소모가 늘어나고 일관성 문제나 성능 저하 같은 조정이 필요할 수 있다. 따라서 시스템의 요구 사항에 맞게 신중하게 고려하는 것이 중요하다.



